{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport { NotFoundError, ExpiredError } from \"./error\";\n\nvar Storage = function () {\n  function Storage() {\n    var _this = this;\n\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, Storage);\n\n    this._SIZE = options.size || 1000;\n    this.sync = options.sync || {};\n    this.defaultExpires = options.defaultExpires !== undefined ? options.defaultExpires : 1000 * 3600 * 24;\n    this.enableCache = options.enableCache !== false;\n    this._s = options.storageBackend || null;\n    this._innerVersion = 11;\n    this.cache = {};\n\n    if (this._s && this._s.setItem) {\n      try {\n        var promiseTest = this._s.setItem('__react_native_storage_test', 'test');\n\n        this.isPromise = !!(promiseTest && promiseTest.then);\n      } catch (e) {\n        console.warn(e);\n        delete this._s;\n        throw e;\n      }\n    } else {\n      console.warn(`Data would be lost after reload cause there is no storageBackend specified!\n      \\nEither use localStorage(for web) or AsyncStorage(for React Native) as a storageBackend.`);\n    }\n\n    this._mapPromise = this.getItem('map').then(function (map) {\n      _this._m = _this._checkMap(map && JSON.parse(map) || {});\n    });\n  }\n\n  _createClass(Storage, [{\n    key: \"getItem\",\n    value: function getItem(key) {\n      return this._s ? this.isPromise ? this._s.getItem(key) : Promise.resolve(this._s.getItem(key)) : Promise.resolve();\n    }\n  }, {\n    key: \"setItem\",\n    value: function setItem(key, value) {\n      return this._s ? this.isPromise ? this._s.setItem(key, value) : Promise.resolve(this._s.setItem(key, value)) : Promise.resolve();\n    }\n  }, {\n    key: \"removeItem\",\n    value: function removeItem(key) {\n      return this._s ? this.isPromise ? this._s.removeItem(key) : Promise.resolve(this._s.removeItem(key)) : Promise.resolve();\n    }\n  }, {\n    key: \"_initMap\",\n    value: function _initMap() {\n      return {\n        innerVersion: this._innerVersion,\n        index: 0,\n        __keys__: {}\n      };\n    }\n  }, {\n    key: \"_checkMap\",\n    value: function _checkMap(map) {\n      if (map && map.innerVersion && map.innerVersion === this._innerVersion) {\n        return map;\n      } else {\n        return this._initMap();\n      }\n    }\n  }, {\n    key: \"_getId\",\n    value: function _getId(key, id) {\n      return key + '_' + id;\n    }\n  }, {\n    key: \"_saveToMap\",\n    value: function _saveToMap(params) {\n      var key = params.key,\n          id = params.id,\n          data = params.data,\n          newId = this._getId(key, id),\n          m = this._m;\n\n      if (m[newId] !== undefined) {\n        if (this.enableCache) this.cache[newId] = JSON.parse(data);\n        return this.setItem('map_' + m[newId], data);\n      }\n\n      if (m[m.index] !== undefined) {\n        var oldId = m[m.index];\n        var splitOldId = oldId.split('_');\n        delete m[oldId];\n\n        this._removeIdInKey(splitOldId[0], splitOldId[1]);\n\n        if (this.enableCache) {\n          delete this.cache[oldId];\n        }\n      }\n\n      m[newId] = m.index;\n      m[m.index] = newId;\n      m.__keys__[key] = m.__keys__[key] || [];\n\n      m.__keys__[key].push(id);\n\n      if (this.enableCache) {\n        var cacheData = JSON.parse(data);\n        this.cache[newId] = cacheData;\n      }\n\n      var currentIndex = m.index;\n\n      if (++m.index === this._SIZE) {\n        m.index = 0;\n      }\n\n      this.setItem('map_' + currentIndex, data);\n      this.setItem('map', JSON.stringify(m));\n    }\n  }, {\n    key: \"save\",\n    value: function save(params) {\n      var _this2 = this;\n\n      var key = params.key,\n          id = params.id,\n          data = params.data,\n          rawData = params.rawData,\n          _params$expires = params.expires,\n          expires = _params$expires === void 0 ? this.defaultExpires : _params$expires;\n\n      if (key.toString().indexOf('_') !== -1) {\n        console.error('Please do not use \"_\" in key!');\n      }\n\n      var dataToSave = {\n        rawData: data\n      };\n\n      if (data === undefined) {\n        if (rawData !== undefined) {\n          console.warn('\"rawData\" is deprecated, please use \"data\" instead!');\n          dataToSave.rawData = rawData;\n        } else {\n          console.error('\"data\" is required in save()!');\n          return;\n        }\n      }\n\n      var now = new Date().getTime();\n\n      if (expires !== null) {\n        dataToSave.expires = now + expires;\n      }\n\n      dataToSave = JSON.stringify(dataToSave);\n\n      if (id === undefined) {\n        if (this.enableCache) {\n          var cacheData = JSON.parse(dataToSave);\n          this.cache[key] = cacheData;\n        }\n\n        return this.setItem(key, dataToSave);\n      } else {\n        if (id.toString().indexOf('_') !== -1) {\n          console.error('Please do not use \"_\" in id!');\n        }\n\n        return this._mapPromise.then(function () {\n          return _this2._saveToMap({\n            key: key,\n            id: id,\n            data: dataToSave\n          });\n        });\n      }\n    }\n  }, {\n    key: \"getBatchData\",\n    value: function getBatchData(querys) {\n      var tasks = [];\n\n      for (var i = 0, query; query = querys[i]; i++) {\n        tasks[i] = this.load(query);\n      }\n\n      return Promise.all(tasks);\n    }\n  }, {\n    key: \"getBatchDataWithIds\",\n    value: function getBatchDataWithIds(params) {\n      var _this3 = this;\n\n      var key = params.key,\n          ids = params.ids,\n          syncInBackground = params.syncInBackground,\n          syncParams = params.syncParams;\n      return Promise.all(ids.map(function (id) {\n        return _this3.load({\n          key: key,\n          id: id,\n          syncInBackground: syncInBackground,\n          autoSync: false,\n          batched: true,\n          syncParams: syncParams\n        });\n      })).then(function (results) {\n        return new Promise(function (resolve, reject) {\n          var ids = results.filter(function (value) {\n            return value.syncId !== undefined;\n          });\n\n          if (!ids.length) {\n            return resolve();\n          }\n\n          return _this3.sync[key]({\n            id: ids.map(function (value) {\n              return value.syncId;\n            }),\n            resolve: resolve,\n            reject: reject,\n            syncParams: syncParams\n          });\n        }).then(function (data) {\n          return results.map(function (value) {\n            return value.syncId ? data.shift() : value;\n          });\n        });\n      });\n    }\n  }, {\n    key: \"_lookupGlobalItem\",\n    value: function _lookupGlobalItem(params) {\n      var _this4 = this;\n\n      var ret;\n      var key = params.key;\n\n      if (this.enableCache && this.cache[key] !== undefined) {\n        ret = this.cache[key];\n        return this._loadGlobalItem(_objectSpread({\n          ret: ret\n        }, params));\n      }\n\n      return this.getItem(key).then(function (ret) {\n        return _this4._loadGlobalItem(_objectSpread({\n          ret: ret\n        }, params));\n      });\n    }\n  }, {\n    key: \"_loadGlobalItem\",\n    value: function _loadGlobalItem(params) {\n      var _this5 = this;\n\n      var key = params.key,\n          ret = params.ret,\n          autoSync = params.autoSync,\n          syncInBackground = params.syncInBackground,\n          syncParams = params.syncParams;\n\n      if (ret === null || ret === undefined) {\n        if (autoSync && this.sync[key]) {\n          return new Promise(function (resolve, reject) {\n            return _this5.sync[key]({\n              resolve: resolve,\n              reject: reject,\n              syncParams: syncParams\n            });\n          });\n        }\n\n        return Promise.reject(new NotFoundError(JSON.stringify(params)));\n      }\n\n      if (typeof ret === 'string') {\n        ret = JSON.parse(ret);\n\n        if (this.enableCache) {\n          this.cache[key] = ret;\n        }\n      }\n\n      var now = new Date().getTime();\n\n      if (ret.expires < now) {\n        if (autoSync && this.sync[key]) {\n          if (syncInBackground) {\n            this.sync[key]({\n              syncParams: syncParams\n            });\n            return Promise.resolve(ret.rawData);\n          }\n\n          return new Promise(function (resolve, reject) {\n            return _this5.sync[key]({\n              resolve: resolve,\n              reject: reject,\n              syncParams: syncParams\n            });\n          });\n        }\n\n        return Promise.reject(new ExpiredError(JSON.stringify(params)));\n      }\n\n      return Promise.resolve(ret.rawData);\n    }\n  }, {\n    key: \"_noItemFound\",\n    value: function _noItemFound(params) {\n      var _this6 = this;\n\n      var key = params.key,\n          id = params.id,\n          autoSync = params.autoSync,\n          syncParams = params.syncParams;\n\n      if (this.sync[key]) {\n        if (autoSync) {\n          return new Promise(function (resolve, reject) {\n            return _this6.sync[key]({\n              id: id,\n              syncParams: syncParams,\n              resolve: resolve,\n              reject: reject\n            });\n          });\n        }\n\n        return Promise.resolve({\n          syncId: id\n        });\n      }\n\n      return Promise.reject(new NotFoundError(JSON.stringify(params)));\n    }\n  }, {\n    key: \"_loadMapItem\",\n    value: function _loadMapItem(params) {\n      var _this7 = this;\n\n      var ret = params.ret,\n          key = params.key,\n          id = params.id,\n          autoSync = params.autoSync,\n          batched = params.batched,\n          syncInBackground = params.syncInBackground,\n          syncParams = params.syncParams;\n\n      if (ret === null || ret === undefined) {\n        return this._noItemFound(params);\n      }\n\n      if (typeof ret === 'string') {\n        ret = JSON.parse(ret);\n        var _key = params.key,\n            _id = params.id;\n\n        var newId = this._getId(_key, _id);\n\n        if (this.enableCache) {\n          this.cache[newId] = ret;\n        }\n      }\n\n      var now = new Date().getTime();\n\n      if (ret.expires < now) {\n        if (autoSync && this.sync[key]) {\n          if (syncInBackground) {\n            this.sync[key]({\n              id: id,\n              syncParams: syncParams\n            });\n            return Promise.resolve(ret.rawData);\n          }\n\n          return new Promise(function (resolve, reject) {\n            return _this7.sync[key]({\n              id: id,\n              resolve: resolve,\n              reject: reject,\n              syncParams: syncParams\n            });\n          });\n        }\n\n        if (batched) {\n          return Promise.resolve({\n            syncId: id\n          });\n        }\n\n        return Promise.reject(new ExpiredError(JSON.stringify(params)));\n      }\n\n      return Promise.resolve(ret.rawData);\n    }\n  }, {\n    key: \"_lookUpInMap\",\n    value: function _lookUpInMap(params) {\n      var _this8 = this;\n\n      var m = this._m,\n          ret;\n      var key = params.key,\n          id = params.id;\n\n      var newId = this._getId(key, id);\n\n      if (this.enableCache && this.cache[newId]) {\n        ret = this.cache[newId];\n        return this._loadMapItem(_objectSpread({\n          ret: ret\n        }, params));\n      }\n\n      if (m[newId] !== undefined) {\n        return this.getItem('map_' + m[newId]).then(function (ret) {\n          return _this8._loadMapItem(_objectSpread({\n            ret: ret\n          }, params));\n        });\n      }\n\n      return this._noItemFound(_objectSpread({\n        ret: ret\n      }, params));\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(params) {\n      var _this9 = this;\n\n      return this._mapPromise.then(function () {\n        var m = _this9._m;\n        var key = params.key,\n            id = params.id;\n\n        if (id === undefined) {\n          if (_this9.enableCache && _this9.cache[key]) {\n            delete _this9.cache[key];\n          }\n\n          return _this9.removeItem(key);\n        }\n\n        var newId = _this9._getId(key, id);\n\n        if (m[newId] !== undefined) {\n          if (_this9.enableCache && _this9.cache[newId]) {\n            delete _this9.cache[newId];\n          }\n\n          _this9._removeIdInKey(key, id);\n\n          var idTobeDeleted = m[newId];\n          delete m[newId];\n\n          _this9.setItem('map', JSON.stringify(m));\n\n          return _this9.removeItem('map_' + idTobeDeleted);\n        }\n      });\n    }\n  }, {\n    key: \"_removeIdInKey\",\n    value: function _removeIdInKey(key, id) {\n      var indexTobeRemoved = (this._m.__keys__[key] || []).indexOf(id);\n\n      if (indexTobeRemoved !== -1) {\n        this._m.__keys__[key].splice(indexTobeRemoved, 1);\n      }\n    }\n  }, {\n    key: \"load\",\n    value: function load(params) {\n      var _this10 = this;\n\n      var key = params.key,\n          id = params.id,\n          _params$autoSync = params.autoSync,\n          autoSync = _params$autoSync === void 0 ? true : _params$autoSync,\n          _params$syncInBackgro = params.syncInBackground,\n          syncInBackground = _params$syncInBackgro === void 0 ? true : _params$syncInBackgro,\n          syncParams = params.syncParams,\n          _params$batched = params.batched,\n          batched = _params$batched === void 0 ? false : _params$batched;\n      return this._mapPromise.then(function () {\n        return new Promise(function (resolve, reject) {\n          if (id === undefined) {\n            return resolve(_this10._lookupGlobalItem({\n              key: key,\n              resolve: resolve,\n              reject: reject,\n              autoSync: autoSync,\n              syncInBackground: syncInBackground,\n              syncParams: syncParams\n            }));\n          }\n\n          return resolve(_this10._lookUpInMap({\n            key: key,\n            id: id,\n            resolve: resolve,\n            reject: reject,\n            autoSync: autoSync,\n            syncInBackground: syncInBackground,\n            syncParams: syncParams,\n            batched: batched\n          }));\n        });\n      });\n    }\n  }, {\n    key: \"clearMap\",\n    value: function clearMap() {\n      var _this11 = this;\n\n      this.removeItem('map').then(function () {\n        _this11.cache = {};\n        _this11._m = _this11._initMap();\n      });\n    }\n  }, {\n    key: \"clearMapForKey\",\n    value: function clearMapForKey(key) {\n      var _this12 = this;\n\n      return this._mapPromise.then(function () {\n        var tasks = (_this12._m.__keys__[key] || []).map(function (id) {\n          return _this12.remove({\n            key: key,\n            id: id\n          });\n        });\n        return Promise.all(tasks);\n      });\n    }\n  }, {\n    key: \"getIdsForKey\",\n    value: function getIdsForKey(key) {\n      var _this13 = this;\n\n      return this._mapPromise.then(function () {\n        return _this13._m.__keys__[key] || [];\n      });\n    }\n  }, {\n    key: \"getAllDataForKey\",\n    value: function getAllDataForKey(key, options) {\n      var _this14 = this;\n\n      options = Object.assign({\n        syncInBackground: true\n      }, options);\n      return this.getIdsForKey(key).then(function (ids) {\n        var querys = ids.map(function (id) {\n          return {\n            key: key,\n            id: id,\n            syncInBackground: options.syncInBackground\n          };\n        });\n        return _this14.getBatchData(querys);\n      });\n    }\n  }]);\n\n  return Storage;\n}();\n\nexport { Storage as default };","map":{"version":3,"names":["NotFoundError","ExpiredError","Storage","options","_SIZE","size","sync","defaultExpires","undefined","enableCache","_s","storageBackend","_innerVersion","cache","setItem","promiseTest","isPromise","then","e","console","warn","_mapPromise","getItem","map","_m","_checkMap","JSON","parse","key","Promise","resolve","value","removeItem","innerVersion","index","__keys__","_initMap","id","params","data","newId","_getId","m","oldId","splitOldId","split","_removeIdInKey","push","cacheData","currentIndex","stringify","rawData","expires","toString","indexOf","error","dataToSave","now","Date","getTime","_saveToMap","querys","tasks","i","query","load","all","ids","syncInBackground","syncParams","autoSync","batched","results","reject","filter","syncId","length","shift","ret","_loadGlobalItem","_noItemFound","_loadMapItem","idTobeDeleted","indexTobeRemoved","splice","_lookupGlobalItem","_lookUpInMap","remove","Object","assign","getIdsForKey","getBatchData"],"sources":["/Users/atsushi/Dev/baby/node_modules/react-native-storage/storage.js"],"sourcesContent":["/*\n *  local storage(web/react native) wrapper\n */\nimport { NotFoundError, ExpiredError } from './error';\n\nexport default class Storage {\n  constructor(options = {}) {\n    this._SIZE = options.size || 1000;   // maximum capacity\n    this.sync = options.sync || {};      // remote sync method\n    this.defaultExpires = options.defaultExpires !== undefined ?\n      options.defaultExpires : 1000 * 3600 * 24;\n    this.enableCache = options.enableCache !== false;\n    this._s = options.storageBackend || null;\n    this._innerVersion = 11;\n    this.cache = {};\n\n    if (this._s && this._s.setItem) {\n      try {\n        var promiseTest = this._s.setItem('__react_native_storage_test', 'test');\n        this.isPromise = !!(promiseTest && promiseTest.then);\n      }\n      catch (e) {\n        console.warn(e);\n        delete this._s;\n        throw e;\n      }\n    } else {\n      console.warn(`Data would be lost after reload cause there is no storageBackend specified!\n      \\nEither use localStorage(for web) or AsyncStorage(for React Native) as a storageBackend.`)\n    }\n\n    this._mapPromise = this.getItem('map').then(map => {\n      this._m = this._checkMap(map && JSON.parse(map) || {});\n      // delete this._mapPromise;\n    });\n  }\n  getItem(key) {\n    return this._s\n      ?\n      this.isPromise ? this._s.getItem(key) : Promise.resolve(this._s.getItem(key))\n      :\n      Promise.resolve();\n  }\n  setItem(key, value) {\n    return this._s\n      ?\n      this.isPromise ? this._s.setItem(key, value) : Promise.resolve(this._s.setItem(key, value))\n      :\n      Promise.resolve();\n  }\n  removeItem(key) {\n    return this._s\n      ? this.isPromise ? this._s.removeItem(key) : Promise.resolve(this._s.removeItem(key))\n      :\n      Promise.resolve();\n  }\n  _initMap() {\n    return {\n      innerVersion: this._innerVersion,\n      index: 0,\n      __keys__: {}\n    };\n  }\n  _checkMap(map) {\n    if(map && map.innerVersion && map.innerVersion === this._innerVersion ) {\n      return map;\n    }\n    else {\n      return this._initMap();\n    }\n  }\n  _getId(key, id) {\n    return key + '_' + id;\n  }\n  _saveToMap(params) {\n    let { key, id, data } = params,\n      newId = this._getId(key, id),\n      m = this._m;\n    if(m[newId] !== undefined) {\n      //update existed data\n      if(this.enableCache) this.cache[newId] = JSON.parse(data);\n      return this.setItem('map_' + m[newId], data);\n    }\n    if(m[m.index] !== undefined){\n      //loop over, delete old data\n      let oldId = m[m.index];\n      let splitOldId = oldId.split('_')\n      delete m[oldId];\n      this._removeIdInKey(splitOldId[0], splitOldId[1])\n      if(this.enableCache) {\n        delete this.cache[oldId];\n      }\n    }\n    m[newId] = m.index;\n    m[m.index] = newId;\n\n    m.__keys__[key] = m.__keys__[key] || [];\n    m.__keys__[key].push(id);\n\n    if(this.enableCache) {\n      const cacheData = JSON.parse(data);\n      this.cache[newId] = cacheData;\n    }\n    let currentIndex = m.index;\n    if(++m.index === this._SIZE) {\n      m.index = 0;\n    }\n    this.setItem('map_' + currentIndex, data);\n    this.setItem('map', JSON.stringify(m));\n  }\n  save(params) {\n    const { key, id, data, rawData, expires = this.defaultExpires } = params;\n    if (key.toString().indexOf('_') !== -1) {\n      console.error('Please do not use \"_\" in key!');\n    }\n    let dataToSave = { rawData: data };\n    if (data === undefined) {\n      if (rawData !== undefined) {\n        console.warn('\"rawData\" is deprecated, please use \"data\" instead!');\n        dataToSave.rawData = rawData;\n      } else {\n        console.error('\"data\" is required in save()!');\n        return;\n      }\n    }\n    let now = new Date().getTime();\n    if(expires !== null) {\n      dataToSave.expires = now + expires;\n    }\n    dataToSave = JSON.stringify(dataToSave);\n    if(id === undefined) {\n      if(this.enableCache) {\n        const cacheData = JSON.parse(dataToSave);\n        this.cache[key] = cacheData;\n      }\n      return this.setItem(key, dataToSave);\n    }\n    else {\n      if(id.toString().indexOf('_') !== -1) {\n        console.error('Please do not use \"_\" in id!');\n      }\n      return this._mapPromise.then(() => this._saveToMap({\n        key,\n        id,\n        data: dataToSave\n      }));\n    }\n  }\n  getBatchData(querys) {\n    let tasks = [];\n    for(let i = 0, query; query = querys[i]; i++) {\n      tasks[i] = this.load(query);\n    }\n    return Promise.all(tasks);\n  }\n  getBatchDataWithIds(params) {\n    let { key, ids, syncInBackground, syncParams } = params;\n\n    return Promise.all(\n      ids.map((id) => this.load({ key, id, syncInBackground, autoSync: false, batched: true, syncParams }))\n    ).then((results) => {\n      return new Promise((resolve, reject) => {\n        const ids = results.filter((value) => value.syncId !== undefined);\n        if(!ids.length){\n          return resolve();\n        }\n        return this.sync[key]({\n          id: ids.map((value) => value.syncId),\n          resolve,\n          reject,\n          syncParams\n        });\n      }).then((data) => {\n        return results.map(value => {\n          return value.syncId ? data.shift() : value\n        });\n      });\n    })\n  }\n  _lookupGlobalItem(params) {\n    let ret;\n    let { key } = params;\n    if(this.enableCache && this.cache[key] !== undefined) {\n      ret = this.cache[key];\n      return this._loadGlobalItem({ ret, ...params });\n    }\n    return this.getItem(key).then(ret => this._loadGlobalItem({ ret, ...params }));\n  }\n  _loadGlobalItem(params) {\n    let { key, ret, autoSync, syncInBackground, syncParams } = params;\n    if(ret === null || ret === undefined) {\n      if(autoSync && this.sync[key]) {\n        return new Promise((resolve, reject) => this.sync[key]({ resolve, reject, syncParams }));\n      }\n      return Promise.reject(new NotFoundError(JSON.stringify(params)));\n    }\n    if (typeof ret === 'string') {\n      ret = JSON.parse(ret);\n      if (this.enableCache) {\n        this.cache[key] = ret;\n      }\n    }\n    let now = new Date().getTime();\n    if(ret.expires < now) {\n      if (autoSync && this.sync[key]){\n        if(syncInBackground) {\n          this.sync[key]({ syncParams });\n          return Promise.resolve(ret.rawData);\n        }\n        return new Promise((resolve, reject) => this.sync[key]({ resolve, reject, syncParams }));\n      }\n      return Promise.reject(new ExpiredError(JSON.stringify(params)));\n    }\n    return Promise.resolve(ret.rawData);\n  }\n  _noItemFound(params) {\n    let { key, id, autoSync, syncParams } = params;\n    if(this.sync[key]) {\n      if(autoSync) {\n        return new Promise((resolve, reject) => this.sync[key]({ id, syncParams, resolve, reject }));\n      }\n      return Promise.resolve({ syncId: id });\n    }\n    return Promise.reject(new NotFoundError(JSON.stringify(params)));\n  }\n  _loadMapItem(params) {\n    let { ret, key, id, autoSync, batched, syncInBackground, syncParams } = params;\n    if(ret === null || ret === undefined) {\n      return this._noItemFound(params);\n    }\n    if(typeof ret === 'string'){\n      ret = JSON.parse(ret);\n      const { key, id } = params;\n      const newId = this._getId(key, id);\n      if (this.enableCache) {\n        this.cache[newId] = ret;\n      }\n    }\n    let now = new Date().getTime();\n    if(ret.expires < now) {\n      if(autoSync && this.sync[key]) {\n        if(syncInBackground) {\n          this.sync[key]({ id, syncParams });\n          return Promise.resolve(ret.rawData);\n        }\n        return new Promise((resolve, reject) => this.sync[key]({ id, resolve, reject, syncParams }));\n      }\n      if(batched) {\n        return Promise.resolve({ syncId: id });\n      }\n      return Promise.reject(new ExpiredError(JSON.stringify(params)));\n    }\n    return Promise.resolve(ret.rawData);\n  }\n  _lookUpInMap(params) {\n    let m = this._m,\n      ret;\n    let { key, id } = params;\n    let newId = this._getId(key, id);\n    if(this.enableCache && this.cache[newId]) {\n      ret = this.cache[newId];\n      return this._loadMapItem( {ret, ...params } );\n    }\n    if(m[newId] !== undefined) {\n      return this.getItem('map_' + m[newId]).then( ret => this._loadMapItem( {ret, ...params } ) );\n    }\n    return this._noItemFound( {ret, ...params } );\n  }\n  remove(params) {\n    return this._mapPromise.then(() => {\n      let m = this._m;\n      let { key, id } = params;\n\n      if(id === undefined) {\n        if(this.enableCache && this.cache[key]) {\n          delete this.cache[key];\n        }\n        return this.removeItem(key);\n      }\n      let newId = this._getId(key, id);\n\n      //remove existed data\n      if(m[newId] !== undefined) {\n        if(this.enableCache && this.cache[newId]) {\n          delete this.cache[newId];\n        }\n        this._removeIdInKey(key, id);\n        let idTobeDeleted = m[newId];\n        delete m[newId];\n        this.setItem('map', JSON.stringify(m));\n        return this.removeItem('map_' + idTobeDeleted);\n      }\n    });\n  }\n  _removeIdInKey(key, id) {\n    let indexTobeRemoved = (this._m.__keys__[key] || []).indexOf(id);\n    if (indexTobeRemoved !== -1) {\n      this._m.__keys__[key].splice(indexTobeRemoved, 1);\n    }\n  }\n  load(params) {\n    let { key, id, autoSync = true, syncInBackground = true, syncParams, batched = false } = params;\n    return this._mapPromise.then(() => new Promise((resolve, reject) => {\n      if(id === undefined) {\n        return resolve(this._lookupGlobalItem({\n          key, resolve, reject, autoSync, syncInBackground, syncParams\n        }));\n      }\n      return resolve(this._lookUpInMap({\n        key, id, resolve, reject, autoSync, syncInBackground, syncParams, batched\n      }));\n    }));\n  }\n  clearMap() {\n    this.removeItem('map').then(() => {\n      this.cache = {};\n      this._m = this._initMap();\n    });\n  }\n  clearMapForKey(key) {\n    return this._mapPromise.then(() => {\n      let tasks = (this._m.__keys__[key] || []).map(id => this.remove({ key, id }));\n      return Promise.all(tasks);\n    });\n  }\n  getIdsForKey(key) {\n    return this._mapPromise.then(() => {\n      return this._m.__keys__[key] || [];\n    });\n  }\n  getAllDataForKey(key, options) {\n    options = Object.assign({ syncInBackground: true }, options);\n    return this.getIdsForKey(key).then(ids => {\n      let querys = ids.map(id => ({ key, id, syncInBackground: options.syncInBackground }));\n      return this.getBatchData(querys);\n    });\n  }\n\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}